# 開発ツール・品質管理

## 📚 目次

1. [Storybook設定](#1-storybook設定)
2. [Playwright テスト](#2-playwright-テスト)
3. [CI/CD パイプライン](#3-cicd-パイプライン)
4. [コード品質管理](#4-コード品質管理)
5. [開発ワークフロー](#5-開発ワークフロー)

---

## 1. Storybook設定

### 基本設定

**.storybook/main.ts**
```typescript
import type { StorybookConfig } from '@storybook/nextjs';

const config: StorybookConfig = {
  stories: ['../src/**/*.stories.@(js|jsx|ts|tsx|mdx)'],
  addons: [
    '@storybook/addon-essentials',
    '@storybook/addon-interactions',
    '@storybook/addon-a11y',
    '@storybook/addon-viewport',
    '@storybook/addon-docs',
  ],
  framework: {
    name: '@storybook/nextjs',
    options: {},
  },
  docs: {
    autodocs: 'tag',
  },
};

export default config;
```

**.storybook/preview.ts**
```typescript
import type { Preview } from '@storybook/react';
import '../src/styles/globals.css';

const preview: Preview = {
  parameters: {
    actions: { argTypesRegex: '^on[A-Z].*' },
    controls: {
      matchers: {
        color: /(background|color)$/i,
        date: /Date$/,
      },
    },
    viewport: {
      viewports: {
        mobile: {
          name: 'Mobile',
          styles: { width: '375px', height: '667px' },
        },
        tablet: {
          name: 'Tablet',
          styles: { width: '768px', height: '1024px' },
        },
        desktop: {
          name: 'Desktop',
          styles: { width: '1200px', height: '800px' },
        },
      },
    },
  },
};

export default preview;
```

### コンポーネントStory例

**compound-calculator.stories.tsx**
```typescript
import type { Meta, StoryObj } from '@storybook/react';
import { CompoundCalculator } from './compound-calculator';

const meta: Meta<typeof CompoundCalculator> = {
  title: 'Calculators/CompoundCalculator',
  component: CompoundCalculator,
  parameters: {
    layout: 'centered',
    docs: {
      description: {
        component: '複利計算機コンポーネント。元本と月々の積立額から将来価値を計算します。',
      },
    },
  },
  tags: ['autodocs'],
  argTypes: {
    onCalculate: { action: 'calculated' },
  },
};

export default meta;
type Story = StoryObj<typeof meta>;

export const Default: Story = {};

export const WithInitialValues: Story = {
  args: {
    initialValues: {
      principal: 1000000,
      monthlyContribution: 50000,
      annualRate: 0.05,
      years: 10,
    },
  },
};

export const SmallAmount: Story = {
  args: {
    initialValues: {
      principal: 100000,
      monthlyContribution: 10000,
      annualRate: 0.03,
      years: 5,
    },
  },
};

export const LargeAmount: Story = {
  args: {
    initialValues: {
      principal: 10000000,
      monthlyContribution: 200000,
      annualRate: 0.07,
      years: 20,
    },
  },
};
```

### Story 作成ガイドライン

**必須Story:**
- `Default`: デフォルト状態
- `WithData`: データが入った状態
- `Loading`: ローディング状態
- `Error`: エラー状態

**推奨Story:**
- `Mobile`: モバイル表示
- `EdgeCases`: エッジケース
- `Interactions`: ユーザー操作

---

## 2. Playwright テスト

### 基本設定

**playwright.config.ts**
```typescript
import { defineConfig, devices } from '@playwright/test';

export default defineConfig({
  testDir: './tests/e2e',
  fullyParallel: true,
  forbidOnly: !!process.env.CI,
  retries: process.env.CI ? 2 : 0,
  workers: process.env.CI ? 1 : undefined,
  reporter: [
    ['html'],
    ['junit', { outputFile: 'test-results/results.xml' }],
  ],
  use: {
    baseURL: 'http://localhost:3000',
    trace: 'on-first-retry',
    screenshot: 'only-on-failure',
  },
  projects: [
    {
      name: 'chromium',
      use: { ...devices['Desktop Chrome'] },
    },
    {
      name: 'firefox',
      use: { ...devices['Desktop Firefox'] },
    },
    {
      name: 'webkit',
      use: { ...devices['Desktop Safari'] },
    },
    {
      name: 'Mobile Chrome',
      use: { ...devices['Pixel 5'] },
    },
  ],
  webServer: {
    command: 'npm run dev',
    url: 'http://localhost:3000',
    reuseExistingServer: !process.env.CI,
  },
});
```

### テスト例

**tests/e2e/calculator.spec.ts**
```typescript
import { test, expect } from '@playwright/test';

test.describe('複利計算機', () => {
  test.beforeEach(async ({ page }) => {
    await page.goto('/compound');
  });

  test('基本的な計算機能', async ({ page }) => {
    // 入力値を設定
    await page.fill('[data-testid="principal-input"]', '1000000');
    await page.fill('[data-testid="monthly-input"]', '50000');
    await page.fill('[data-testid="rate-input"]', '5');
    await page.fill('[data-testid="years-input"]', '10